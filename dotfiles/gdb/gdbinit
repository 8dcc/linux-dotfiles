# Some inspiration for this config:
#   https://interrupt.memfault.com/blog/advanced-gdb

# Allow loading of project-specific gdbinit. See section 2.1.4.4 "Local
# directory initialization file" of GDB Manual.
set auto-load local-gdbinit
add-auto-load-safe-path ~

# Persist history across sessions
set history save on
set history size 1000
set history filename ~/.gdb_history

# Don't ask for stupid debuginfod prompt when running
set debuginfod enabled off

# Display instructions in Intel format
set disassembly-flavor intel

alias x8dcc_print_stack = x/64b $sp
document x8dcc_print_stack
  Usage: x8dcc_print_stack

  Print 64 bytes of the stack ($sp).
end

define x8dcc_xxd
  dump binary memory /tmp/gdb-xdd-dump.bin $arg0 ((char *)$arg0)+$arg1
  shell xxd /tmp/gdb-xdd-dump.bin
end
document x8dcc_xxd
  Usage: x8dcc_xxd ADDR LENGTH

  Dump LENGTH bytes from the specified memory ADDR using 'xxd'.
end
